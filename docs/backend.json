{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the Nusantara OSIS Hub application.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "User ID from Firebase Authentication. Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "position": {
          "type": "string",
          "description": "Specific role or title held by the user within OSIS (e.g., 'Ketua OSIS', 'Sekretaris 1')."
        },
        "divisionId": {
          "type": "string",
          "description": "Reference to Division. (Relationship: Division 1:N User)"
        },
        "divisionName": {
          "type": "string",
          "description": "Name of the division the user belongs to (e.g., 'Pengurus Inti', 'Divisi Teknologi dan Komunikasi')."
        },
        "accessLevel": {
          "type": "number",
          "description": "Numerical value representing the user's hierarchical level within OSIS (e.g., 10: Ketua, 9: Wakil, etc.)."
        }
      },
      "required": [
        "uid",
        "email",
        "name",
        "position",
        "divisionId",
        "divisionName",
        "accessLevel"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task assigned within the OSIS organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the task."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the task."
        },
        "assignedToUID": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task) UID of the member assigned to the task."
        },
        "assignedByUID": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Task) UID of the member who assigned the task."
        },
        "divisionId": {
          "type": "string",
          "description": "Reference to Division. (Relationship: Division 1:N Task) ID of the division the task is related to."
        },
        "dueDate": {
          "type": "string",
          "description": "Date and time when the task is due.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the task (e.g., 'pending', 'in-progress', 'completed', 'overdue')."
        },
        "priority": {
          "type": "string",
          "description": "Priority level of the task (e.g., 'low', 'medium', 'high', 'urgent')."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "assignedToUID",
        "assignedByUID",
        "divisionId",
        "dueDate",
        "status",
        "priority"
      ]
    },
    "Workflow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Workflow",
      "type": "object",
      "description": "Represents an automated workflow within the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Workflow entity."
        },
        "triggerName": {
          "type": "string",
          "description": "Name of the event that triggers the workflow (e.g., 'eventApproved')."
        },
        "actions": {
          "type": "array",
          "description": "Array of actions to be performed when the workflow is triggered.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "triggerName",
        "actions"
      ]
    },
    "Report": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Report",
      "type": "object",
      "description": "Represents a report submitted within the OSIS organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Report entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the report."
        },
        "content": {
          "type": "string",
          "description": "Content of the report."
        },
        "submittedByUID": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Report) UID of the member who submitted the report."
        },
        "submittedForPosition": {
          "type": "string",
          "description": "Position for whom the report is submitted (e.g., 'Ketua OSIS')."
        },
        "reportType": {
          "type": "string",
          "description": "Type of the report (e.g., 'bulanan', 'kegiatan', 'keuangan')."
        },
        "status": {
          "type": "string",
          "description": "Current status of the report (e.g., 'draft', 'submitted', 'approved', 'rejected')."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "submittedByUID",
        "submittedForPosition",
        "reportType",
        "status"
      ]
    },
    "Division": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Division",
      "type": "object",
      "description": "Represents a division within the OSIS organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Division entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the division (e.g., 'Divisi Keimanan & Ketaqwaan')."
        },
        "description": {
          "type": "string",
          "description": "Description of the division's responsibilities and activities."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership for security. Includes user details such as UID, email, name, position, division, and access level.",
          "params": [
            {
              "name": "userId",
              "description": "User ID from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/divisions/{divisionId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks assigned to users within specific divisions. Includes `assignedToUID` and `assignedByUID` to track task assignment and `divisionId`. Segregating tasks by division supports efficient listing and querying of tasks within a division.",
          "params": [
            {
              "name": "divisionId",
              "description": "ID of the division the task is related to."
            },
            {
              "name": "taskId",
              "description": "Unique identifier for the Task entity."
            }
          ]
        }
      },
      {
        "path": "/workflows/{workflowId}",
        "definition": {
          "entityName": "Workflow",
          "schema": {
            "$ref": "#/backend/entities/Workflow"
          },
          "description": "Stores automated workflows triggered by events.",
          "params": [
            {
              "name": "workflowId",
              "description": "Unique identifier for the Workflow entity."
            }
          ]
        }
      },
      {
        "path": "/reports/{reportId}",
        "definition": {
          "entityName": "Report",
          "schema": {
            "$ref": "#/backend/entities/Report"
          },
          "description": "Stores reports submitted by users. Includes `submittedByUID` and `submittedForPosition` to track report submissions.",
          "params": [
            {
              "name": "reportId",
              "description": "Unique identifier for the Report entity."
            }
          ]
        }
      },
      {
        "path": "/divisions/{divisionId}",
        "definition": {
          "entityName": "Division",
          "schema": {
            "$ref": "#/backend/entities/Division"
          },
          "description": "Stores division information.",
          "params": [
            {
              "name": "divisionId",
              "description": "Unique identifier for the Division entity."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Nusantara OSIS Hub application, emphasizing personalized user experiences, role-based access control, and efficient task management. Authorization Independence is achieved by using path-based ownership for user data and denormalizing user roles and division information within tasks and reports collections, eliminating the need for `get()` calls in security rules and enabling atomic operations.\n\n*   **User Data (`/users/{userId}`):** Stores user profiles with essential information like UID, email, name, position, division, and access level. The path-based ownership ensures that only the user (or admins) can access their data.\n*   **Tasks (`/divisions/{divisionId}/tasks/{taskId}`):** Stores tasks assigned to users within specific divisions. Includes `assignedToUID` and `assignedByUID` to track task assignment. Segregating tasks by division (using a subcollection) supports efficient listing and querying of tasks within a division, satisfying the QAPs. The `divisionId` denormalizes the link to the division. While not directly denormalizing authorization data for the user involved, the path segregation to the division allows clear, simple authorization rules. Further denormalization of assignedToUIDs roles within a `members` map would fully eliminate authorization dependencies.\n*   **Workflows (`/workflows/{workflowId}`):** Stores automated workflows triggered by events. While workflows themselves don't directly involve user authorization, their execution (triggered by events) may need to be secured using Cloud Functions with appropriate role checks.\n*   **Reports (`/reports/{reportId}`):** Stores reports submitted by users. Includes `submittedByUID` and `submittedForPosition` to track report submissions. Storing reports in a top-level collection (rather than as subcollections of users or divisions) simplifies querying and reporting across the entire OSIS organization. While segregation is not used, the `submittedByUID` field enables straightforward ownership-based security rules. Using a membership model here (e.g. `canView: {uid1: true, uid2:true}`) would further improve authorization independence.\n*   **Divisions (`/divisions/{divisionId}`):** Stores division information. This collection serves as a lookup for division details and is referenced by tasks and users. The path structure ensures the integrity of division data and supports efficient querying of division-related information.\n\nThis structure provides a solid foundation for building the Nusantara OSIS Hub application, enabling secure and efficient management of user data, tasks, workflows, and reports."
  }
}